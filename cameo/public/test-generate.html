<!DOCTYPE html>
<!--
 Copyright 2025 Google LLC

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
-->

<html>
<head>
  <title>Test Video Generation Pipeline</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      max-width: 900px;
      margin: 40px auto;
      padding: 20px;
      line-height: 1.6;
    }
    
    .hero {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 30px;
      border-radius: 12px;
      margin-bottom: 30px;
    }
    
    form {
      background: #f5f5f5;
      padding: 25px;
      border-radius: 8px;
      margin: 20px 0;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      color: #333;
    }
    
    input[type="text"],
    input[type="file"],
    textarea {
      width: 100%;
      padding: 10px;
      border: 2px solid #ddd;
      border-radius: 6px;
      box-sizing: border-box;
      font-size: 14px;
    }
    
    textarea {
      min-height: 100px;
      font-family: inherit;
    }
    
    .helper-text {
      color: #666;
      font-size: 13px;
      margin-top: 5px;
      font-style: italic;
    }
    
    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 12px 30px;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s;
    }
    
    button:hover {
      transform: translateY(-2px);
    }
    
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }
    
    #status {
      margin-top: 25px;
      padding: 20px;
      border-radius: 8px;
      font-weight: 600;
    }
    
    #status:empty {
      display: none;
    }
    
    #status.processing {
      background: #fff3cd;
      border: 2px solid #ffc107;
      color: #856404;
    }
    
    #status.success {
      background: #d4edda;
      border: 2px solid #28a745;
      color: #155724;
    }
    
    #status.error {
      background: #f8d7da;
      border: 2px solid #dc3545;
      color: #721c24;
    }
    
    #result {
      margin-top: 20px;
      padding: 20px;
      background: white;
      border: 2px solid #ddd;
      border-radius: 8px;
    }
    
    #result:empty {
      display: none;
    }
    
    .stats {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 6px;
      margin: 15px 0;
    }
    
    .stats-row {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #ddd;
    }
    
    .stats-row:last-child {
      border-bottom: none;
    }
    
    code {
      background: #f5f5f5;
      padding: 3px 8px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
    }
    
    .pipeline-steps {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin: 20px 0;
    }
    
    .step {
      padding: 12px;
      margin: 10px 0;
      background: #f8f9fa;
      border-left: 4px solid #667eea;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <div class="hero">
    <h1>üé¨ Unified Video Generation Pipeline</h1>
    <p>Test the complete end-to-end video generation with voice cloning</p>
  </div>
  
  <div class="pipeline-steps">
    <h3>Pipeline Steps:</h3>
    <div class="step">1Ô∏è‚É£ Train voice with ElevenLabs</div>
    <div class="step">2Ô∏è‚É£ Generate video with Veo 3 (using face image)</div>
    <div class="step">3Ô∏è‚É£ Poll until video generation completes</div>
    <div class="step">4Ô∏è‚É£ Download generated video</div>
    <div class="step">5Ô∏è‚É£ Swap audio with cloned voice</div>
  </div>
  
  <form id="generateForm">
    <div class="form-group">
      <label>Center Face Image (PNG):</label>
      <input type="file" name="centerImage" accept="image/png,image/jpeg" required>
      <div class="helper-text">The reference face image from your capture</div>
    </div>
    
    <div class="form-group">
      <label>Voice Recording Audio:</label>
      <input type="file" name="voiceAudio" accept="audio/*" required>
      <div class="helper-text">10 seconds of voice recording for training</div>
    </div>
    
    <div class="form-group">
      <label>Voice Name:</label>
      <input type="text" name="voiceName" value="My Voice Clone" required>
      <div class="helper-text">A name for your voice model</div>
    </div>
    
    <div class="form-group">
      <label>Video Prompt:</label>
      <textarea name="prompt" required placeholder="A person says: 'Hello, this is my first AI-generated video!' They smile and wave at the camera."></textarea>
      <div class="helper-text">
        Describe what the person should say and do. Use quotes for dialogue.<br>
        Example: "A person says: 'Welcome to my channel!' They look happy and enthusiastic."
      </div>
    </div>
    
    <button type="submit" id="submitBtn">üé¨ Generate Video</button>
  </form>

  <div id="status"></div>
  <div id="result"></div>

  <script>
    document.getElementById('generateForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const status = document.getElementById('status');
      const result = document.getElementById('result');
      const submitBtn = document.getElementById('submitBtn');
      
      // Reset
      status.className = 'processing';
      status.innerHTML = `
        <h3>‚è≥ Processing...</h3>
        <p>This will take 1-6 minutes depending on Veo 3 generation time.</p>
        <p>Please be patient...</p>
      `;
      result.innerHTML = '';
      submitBtn.disabled = true;
      
      const formData = new FormData(e.target);
      
      try {
        const startTime = Date.now();
        
        const response = await fetch('/api/generate-video', {
          method: 'POST',
          body: formData
        });
        
        const data = await response.json();
        const elapsed = Math.floor((Date.now() - startTime) / 1000);
        
        if (data.success) {
          status.className = 'success';
          status.innerHTML = `<h3>‚úÖ Success!</h3><p>Video generated in ${elapsed} seconds</p>`;
          result.innerHTML = `
            <h3>üéâ Video Generation Complete!</h3>
            
            <div class="stats">
              <h4>Performance Stats:</h4>
              <div class="stats-row">
                <span>Total Time:</span>
                <strong>${Math.floor(data.stats.totalTimeMs / 1000)}s</strong>
              </div>
              <div class="stats-row">
                <span>Veo 3 Generation:</span>
                <strong>${Math.floor(data.stats.veoGenerationMs / 1000)}s (${data.stats.pollCount} polls)</strong>
              </div>
              <div class="stats-row">
                <span>Audio Swap:</span>
                <strong>${Math.floor(data.stats.audioSwapMs / 1000)}s</strong>
              </div>
              <div class="stats-row">
                <span>Voice ID:</span>
                <code>${data.voiceId}</code>
              </div>
            </div>
            
            <p><strong>Output file:</strong> <code>${data.outputPath}</code></p>
            
            <hr style="margin: 25px 0;">
            
            <h4>üé• View Your Video:</h4>
            <ol>
              <li>Open your project directory</li>
              <li>Navigate to <code>cameo/test-data/</code></li>
              <li>Play the generated video file</li>
            </ol>
            
            <p style="margin-top: 20px;">
              <strong>Quick play command:</strong><br>
              <code>ffplay ${data.outputPath}</code>
            </p>
            
            <p style="margin-top: 15px; padding: 15px; background: #e3f2fd; border-radius: 6px;">
              <strong>üí° Tip:</strong> Your cloned voice has been applied to the video!
              Listen carefully to verify the voice matches your recording.
            </p>
          `;
        } else {
          status.className = 'error';
          status.innerHTML = `<h3>‚ùå Error</h3>`;
          result.innerHTML = `
            <p><strong>Error:</strong> ${data.error}</p>
            <p>Check the server console for more details.</p>
          `;
        }
      } catch (error) {
        status.className = 'error';
        status.innerHTML = `<h3>‚ùå Network Error</h3>`;
        result.innerHTML = `
          <p><strong>Error:</strong> ${error.message}</p>
          <p>Make sure your dev server is running and the API endpoint is accessible.</p>
        `;
      } finally {
        submitBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
